<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Add essential dotenv support to your wordpress without a plugin - emre.xyz | @delirehberi</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="You may want to start using Environment variables to configure your WordPress application. I did because I needed to install a development environment to my local and did not want to keep separate wp-config.php files.
So, how did I that?"><meta property="og:image" content><meta property="og:title" content="Add essential dotenv support to your wordpress without a plugin"><meta property="og:description" content="You may want to start using Environment variables to configure your WordPress application. I did because I needed to install a development environment to my local and did not want to keep separate wp-config.php files.
So, how did I that?"><meta property="og:type" content="article"><meta property="og:url" content="https://ozgurvurgun.github.io/posts/add-essential-dotenv-support-to-your-wordpress-without-a-plugin/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-16T00:00:00+00:00"><meta property="article:modified_time" content="2022-10-16T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Add essential dotenv support to your wordpress without a plugin"><meta name=twitter:description content="You may want to start using Environment variables to configure your WordPress application. I did because I needed to install a development environment to my local and did not want to keep separate wp-config.php files.
So, how did I that?"><script src=https://ozgurvurgun.github.io/js/feather.min.js></script>
<link href=https://ozgurvurgun.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://ozgurvurgun.github.io/css/main.6a0f23ea50fd34b46fee262a5a68e17d458c51a2bc99ba1ba018065de6b180c3.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://ozgurvurgun.github.io/css/dark.50b57e12d401420df23965fed157368aba37b76df0ecefd0b1ecd4da664f01a0.css media="(prefers-color-scheme: dark)"><script async src="https://www.googletagmanager.com/gtag/js?id=G-VLZVJMKPNJ"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VLZVJMKPNJ")</script></head><body><div class=content><header><div class=main><a href=https://ozgurvurgun.github.io/>emre.xyz | @delirehberi</a></div><nav><a href=/>main</a>
<a href=https://gist.github.com/delirehberi>gist</a>
<a href=https://nostr.emre.xyz>nostr</a>
<a href=/til>til</a>
<a href=/about>me</a>
<a href=/subscribe>subscribe</a>
<a href=/resume.pdf>resume</a></nav></header><main><article><div class=post-container><div class=post-content><div class=title><h1 class=title>Add essential dotenv support to your wordpress without a plugin</h1><div class=meta>Posted on Oct 16, 2022</div></div><section class=body><p>You may want to start using Environment variables to configure your WordPress application. I did because I needed to install a development environment to my local and did not want to keep separate wp-config.php files.</p><p>So, how did I that?</p><p>I am already using <code>direnv</code> to manage environment variables dependent on folders. When I work on X project, it automatically loads the required env variables. You can check out at <a href=direnv.net>direnv.net</a></p><p>First, I created a <code>.envrc</code> file with that content;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>dotenv .env
</span></span></code></pre></div><p>It will use variables inside the .env file to configure my environment. This is an example content of the <code>.env</code> file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>APP_ENV=dev
</span></span><span style=display:flex><span>WP_DEBUG=true
</span></span><span style=display:flex><span>WORDPRESS_DB_NAME=eresbiotech
</span></span><span style=display:flex><span>WORDPRESS_DB_USER=moodif
</span></span><span style=display:flex><span>WORDPRESS_DB_PASSWORD=1542bilim
</span></span><span style=display:flex><span>WORDPRESS_DB_HOST=db
</span></span></code></pre></div><p>It&rsquo;s a simple key-value file.</p><p>After that, I allowed the direnv to load that environment with the <code>direnv allow</code> command.</p><p>Then, I updated my <code>wp-config.php</code> file to fetch variables from the environment.
I&rsquo;ve just added database-related configs. You can add salt keys and other configs like this.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;DB_NAME&#39;</span>, <span style=color:#a6e22e>getenv</span>(<span style=color:#e6db74>&#39;WORDPRESS_DB_NAME&#39;</span>));
</span></span><span style=display:flex><span><span style=color:#e6db74>/** MySQL database username */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;DB_USER&#39;</span>, <span style=color:#a6e22e>getenv</span>(<span style=color:#e6db74>&#39;WORDPRESS_DB_USER&#39;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>/** MySQL database password */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;DB_PASSWORD&#39;</span>, <span style=color:#a6e22e>getenv</span>(<span style=color:#e6db74>&#39;WORDPRESS_DB_PASSWORD&#39;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>/** MySQL hostname */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;DB_HOST&#39;</span>, <span style=color:#a6e22e>getenv</span>(<span style=color:#e6db74>&#39;WORDPRESS_DB_HOST&#39;</span>));
</span></span></code></pre></div><p>You see, easy-peasy. Not much. I expected it to work like a charm, but it didn&rsquo;t because I was using PHP-FPM and Nginx together.</p><p>There are different ways to allow php-fpm to fetch system environment files, but I loved dotenv too much. There are tons of different scenarios in which you cannot access PHP or server configs (like using hosting)</p><p>Anyway, I decided to write this simple snippet (there is a <a href=https://github.com/vlucas/phpdotenv>library</a> to do that, but I do not want to add a library to WordPress yet)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>getenv</span>(<span style=color:#e6db74>&#39;APP_ENV&#39;</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>file_exists</span>(<span style=color:#a6e22e>ABSPATH</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#39;.env&#39;</span>)){
</span></span><span style=display:flex><span>    $content <span style=color:#f92672>=</span> <span style=color:#a6e22e>file_get_contents</span>(<span style=color:#a6e22e>ABSPATH</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#39;.env&#39;</span>);
</span></span><span style=display:flex><span>    $envs <span style=color:#f92672>=</span> <span style=color:#a6e22e>explode</span>(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>,$content);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>foreach</span>($envs <span style=color:#66d9ef>as</span> $env){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#66d9ef>empty</span>($env)){<span style=color:#66d9ef>continue</span>;}
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>putenv</span>($env);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then add that file to the <code>wp-load.php</code> file. After the first <code>if</code> condition;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>if</span> ( <span style=color:#f92672>!</span> <span style=color:#a6e22e>defined</span>( <span style=color:#e6db74>&#39;ABSPATH&#39;</span> ) ) { <span style=color:#75715e>//this is the first if condition in the file
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>define</span>( <span style=color:#e6db74>&#39;ABSPATH&#39;</span>, <span style=color:#66d9ef>__DIR__</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;/&#39;</span> );
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span>(<span style=color:#a6e22e>ABSPATH</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#39;/dotenv.php&#39;</span>); <span style=color:#75715e>//this is our code
</span></span></span></code></pre></div><p>Then it will be ready to use. <code>dotenv.php</code> file reads <code>.env</code> file content in your local/prod server, then it will load values. <code>wp-config.php</code> file will use that values to configure the WordPress.</p><p>Let me tell you one more thing before I finish the post. You have to achieve one more step if you are using <code>wp-cli</code> in your server. <code>wp-cli</code> is using <code>wp-config.php</code> to configure the tool itself, but this file does not know how to load <code>.env</code> file. We can add this snippet to the top of the <code>wp-config.php</code> file to prevent issues.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>getenv</span>(<span style=color:#e6db74>&#39;APP_ENV&#39;</span>)){ <span style=color:#75715e>//for wp-cli
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>include</span> <span style=color:#e6db74>&#39;./dotenv.php&#39;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>You did it!</p><p>You can have separate installations for your WordPress now without changing any code block or installing plugins.</p><p>Of course, there is a downside to this approach. You have to care <code>wp-load.php</code> and <code>wp-config.php</code> files after every core update. But it&rsquo;s a tiny downside. I am using git to follow changes, I am just reverting the changes in this file after the update (or I am adding required lines to new versions of this file), and it&rsquo;s done.</p><p>keep safe kittens</p><blockquote><p>final notice; do not forget to configure the public access to <code>.env</code> file from outworld. no one wants to share db password with others. check <a href=http://yoursite.com/.env>http://yoursite.com/.env</a> URL, it must return 404. <a href="https://www.google.it/search?q=how+to+deny+access+to+file+htaccess">for apache</a> , <a href="https://www.google.it/search?q=how+to+deny+access+to+file+nginx">for nginx</a></p></blockquote></section><div class=post-tags></div></div></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/ozgurvurgun rel=me title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://bsky.app/profile/emre.xyz rel=me title=Bluesky><i data-feather=at-sign></i></a>
<a class=border></a><a class=soc href=https://youtube.com/EmreYILMAZ rel=me title=Youtube><i data-feather=youtube></i></a>
<a class=border></a><a class=soc href=https://linkedin.com/in/delirehberi rel=me title=Linkedin><i data-feather=linkedin></i></a>
<a class=border></a><a class=soc href=https://satellite.earth/@delirehberi@emre.xyz rel=me title=Nostr><i data-feather=at-sign></i></a>
<a class=border></a><a class=soc href=http://emre.xyz/me.vcf rel=me title=VCF><i data-feather=phone></i></a>
<a class=border></a><a class=soc href=http://emre.xyz/resume.pdf rel=me title=Resume><i data-feather=file-text></i></a>
<a class=border></a></div><div class=footer-info>2025 delirehberi | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script>feather.replace()</script></div></body></html>