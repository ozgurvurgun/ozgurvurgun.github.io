<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Doctrine postgresql fonksiyonlari - emre.xyz | @delirehberi</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Symfony ile uygulama geliştirirken tüm veritabanı işlemleri Doctrine üzerinden gerçekleştiriliyor. Doctrine ise tüm veritabanlarına ortada durabilmek adına maksimum ortak paydaya ulaşarak buna uygun programlanıyor.
Yani bir özellik geliştirileceği zaman, en optimum şekilde, tüm veritabanlarına uyacak kadarını geliştiriyorlar. Bu sebeple PostgreSQL&rsquo;in pek çok güzel özelliği içerisinde gelmiyor."><meta property="og:image" content><meta property="og:title" content="Doctrine postgresql fonksiyonlari"><meta property="og:description" content="Symfony ile uygulama geliştirirken tüm veritabanı işlemleri Doctrine üzerinden gerçekleştiriliyor. Doctrine ise tüm veritabanlarına ortada durabilmek adına maksimum ortak paydaya ulaşarak buna uygun programlanıyor.
Yani bir özellik geliştirileceği zaman, en optimum şekilde, tüm veritabanlarına uyacak kadarını geliştiriyorlar. Bu sebeple PostgreSQL&rsquo;in pek çok güzel özelliği içerisinde gelmiyor."><meta property="og:type" content="article"><meta property="og:url" content="https://ozgurvurgun.github.io/posts/doctrine-postgresql-fonksiyonlari/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-05-08T00:00:00+00:00"><meta property="article:modified_time" content="2020-05-08T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Doctrine postgresql fonksiyonlari"><meta name=twitter:description content="Symfony ile uygulama geliştirirken tüm veritabanı işlemleri Doctrine üzerinden gerçekleştiriliyor. Doctrine ise tüm veritabanlarına ortada durabilmek adına maksimum ortak paydaya ulaşarak buna uygun programlanıyor.
Yani bir özellik geliştirileceği zaman, en optimum şekilde, tüm veritabanlarına uyacak kadarını geliştiriyorlar. Bu sebeple PostgreSQL&rsquo;in pek çok güzel özelliği içerisinde gelmiyor."><script src=https://ozgurvurgun.github.io/js/feather.min.js></script>
<link href=https://ozgurvurgun.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://ozgurvurgun.github.io/css/main.6a0f23ea50fd34b46fee262a5a68e17d458c51a2bc99ba1ba018065de6b180c3.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://ozgurvurgun.github.io/css/dark.50b57e12d401420df23965fed157368aba37b76df0ecefd0b1ecd4da664f01a0.css media="(prefers-color-scheme: dark)"><script async src="https://www.googletagmanager.com/gtag/js?id=G-VLZVJMKPNJ"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VLZVJMKPNJ")</script></head><body><div class=content><header><div class=main><a href=https://ozgurvurgun.github.io/>emre.xyz | @delirehberi</a></div><nav><a href=/>main</a>
<a href=https://gist.github.com/delirehberi>gist</a>
<a href=https://nostr.emre.xyz>nostr</a>
<a href=/til>til</a>
<a href=/about>me</a>
<a href=/subscribe>subscribe</a>
<a href=/resume.pdf>resume</a></nav></header><main><article><div class=post-container><div class=post-content><div class=title><h1 class=title>Doctrine postgresql fonksiyonlari</h1><div class=meta>Posted on May 8, 2020</div></div><section class=body><p>Symfony ile uygulama geliştirirken tüm veritabanı işlemleri Doctrine üzerinden gerçekleştiriliyor. Doctrine ise tüm veritabanlarına ortada durabilmek adına maksimum ortak paydaya ulaşarak buna uygun programlanıyor.</p><p>Yani bir özellik geliştirileceği zaman, en optimum şekilde, tüm veritabanlarına uyacak kadarını geliştiriyorlar. Bu sebeple PostgreSQL&rsquo;in pek çok güzel özelliği içerisinde gelmiyor.</p><p>Tabi ki <code>native sql</code> yazarak Doctrine içerisinden direkt saf PostgreSQL sorgusu çalıştırabiliyorsunuz. Fakat benim bahsetmek istediğim Doctrine&rsquo;in diğer bir güzel özelliği <code>kullanıcı tanımlı DQL fonksiyonları</code> kullanabiliyor olmak.</p><p>Çok detaya inmeden bahsetmek gerekirse; Doctrine SQL sorgularını yazılımcıdan DQL formatında talep edip, kendisi veritabanına uygun hale getirip SQL üretiyor. DQL formatında ise yukarıda bahsettiğim sebepten ötürü sadece belirli veritabanı özelliklerini destekleyebiliyor. Fakat DQL formatı genişletilebilir bir format olduğu için biz kendi DQL özelliklerimizi yazıp, Doctrine&rsquo;e kazandırabiliyoruz.</p><p>PostgreSQL fonksiyonlarını kullanabilmek için de bu özellikten yararlanacağız. Doctrine kendi<a href=https://www.doctrine-project.org/projects/doctrine-orm/en/2.7/cookbook/dql-user-defined-functions.html#dql-user-defined-functions>*</a> sitesinde çok güzel şekilde nasıl kendi DQL fonksiyonları yazabileceğinizi anlatmış.</p><p>Peki ben niye konuşuyorum?</p><p>Tabi ki <a href=https://github.com/martin-georgiev/postgresql-for-doctrine>Martin Georgiev</a>&lsquo;in zaten yazmış olduğu, PostgreSQL fonksiyonlarının DQL genişletmelerini içeren paketten bahsetmek için.</p><p>Composer ile paketi yükleyebiliyorsunuz.</p><p><code>composer require martin-georgiev/postgresql-for-doctrine</code></p><p>Sonrası ise kullanacağınız fonksiyonları, framework&rsquo;ünüze özel olarak tanımlamak kalıyor. Bu bir Doctrine paketi olduğu için Symfony bağımlı değil, diğer frameworklerle veya frameworksüz de kullanabilirsiniz.</p><p>Symfony 5 için aşağıdaki gibi tanımlayabiliyorsunuz:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>doctrine</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>dbal</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>types</span>: 
</span></span><span style=display:flex><span>          <span style=color:#f92672>text[]</span>: <span style=color:#ae81ff>MartinGeorgiev\Doctrine\DBAL\Types\TextArray</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>mapping_types</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>text[]</span>: <span style=color:#ae81ff>text[]</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>_text</span>: <span style=color:#ae81ff>text[]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>orm</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>dql</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>string_functions</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>ANY_OF</span>: <span style=color:#ae81ff>MartinGeorgiev\Doctrine\ORM\Query\AST\Functions\Any</span>
</span></span></code></pre></div><p>Sadece <code>text[]</code> türünü ve <code>ANY</code> fonksiyonunu yükledim bu örnekte. Tüm fonksiyon ve türler için <a href=https://github.com/martin-georgiev/postgresql-for-doctrine/blob/master/docs/INTEGRATING-WITH-SYMFONY.md>postgresql-for-doctrine</a> dökümanına göz atabilirsiniz.</p><p>Ayarlarınızı yaptıktan sonra ise kullanması kalıyor. Normalde her şeyi <code>Expr</code> ile oluşturmayı seviyorum ancak kullanıcı tanımlı bu fonksiyonlar için <code>Expr</code> ifadeleri bulunmuyor.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>    $qb <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>createQueryBuilder</span>(<span style=color:#e6db74>&#39;u&#39;</span>);
</span></span><span style=display:flex><span>    $qb<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>andWhere</span>(<span style=color:#e6db74>&#34;:role &lt;&gt; ANY_OF(u.roles)&#34;</span>)
</span></span><span style=display:flex><span>       <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setParameter</span>(<span style=color:#e6db74>&#39;role&#39;</span>,<span style=color:#e6db74>&#39;ROLE_ADMIN&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $qb<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getQuery</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getResult</span>();
</span></span></code></pre></div><p>Yukarıda gördüğünüz gibi, sorgu olarak direkt kullanabiliyoruz.</p><p>Dikkat etmeniz gereken şey, PostgreSQL ifadelerinden bazıları DQL&rsquo;de aynı isimde geçmiyor. PostgreSQL&rsquo;de bulunan <code>ANY</code> ve <code>ALL</code> gibi fonksiyonları <code>ANY_OF</code> ve <code>ALL_OF</code> gibi DQL&rsquo;e geçmiş olmasının sebebi, zaten DQL içerisinde <code>ANY</code> ve <code>ALL</code> adında iki fonksiyonun bulunması. Ama tabi ki amaçları bambaşka.</p></section><div class=post-tags></div></div></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/ozgurvurgun rel=me title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://bsky.app/profile/emre.xyz rel=me title=Bluesky><i data-feather=at-sign></i></a>
<a class=border></a><a class=soc href=https://youtube.com/EmreYILMAZ rel=me title=Youtube><i data-feather=youtube></i></a>
<a class=border></a><a class=soc href=https://linkedin.com/in/delirehberi rel=me title=Linkedin><i data-feather=linkedin></i></a>
<a class=border></a><a class=soc href=https://satellite.earth/@delirehberi@emre.xyz rel=me title=Nostr><i data-feather=at-sign></i></a>
<a class=border></a><a class=soc href=http://emre.xyz/me.vcf rel=me title=VCF><i data-feather=phone></i></a>
<a class=border></a><a class=soc href=http://emre.xyz/resume.pdf rel=me title=Resume><i data-feather=file-text></i></a>
<a class=border></a></div><div class=footer-info>2025 delirehberi | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script>feather.replace()</script></div></body></html>